#!/usr/bin/env bash

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
MAGENTA='\033[0;35m'
CYAN='\033[0;36m'
BOLD='\033[1m'
RESET='\033[0m'

# Check if tmux is running
if ! tmux ls &>/dev/null; then
    echo -e "${RED}No tmux sessions found${RESET}"
    exit 0
fi

# Print header
printf "${BOLD}${CYAN}%-20s %-8s %-18s %s${RESET}\n" "SESSION" "WINDOWS" "CREATED" "STATUS"
echo -e "${CYAN}────────────────────────────────────────────────────────────────${RESET}"

# Parse tmux ls output and format it
tmux ls -F "#{session_name}|#{session_windows}|#{session_created}|#{session_attached}" | while IFS='|' read -r name windows created attached; do
    # Convert timestamp to readable format
    created_date=$(date -d "@${created}" "+%Y-%m-%d %H:%M" 2>/dev/null || date -r "${created}" "+%Y-%m-%d %H:%M" 2>/dev/null)

    # Color based on attached status
    if [ "$attached" = "1" ]; then
        status="${GREEN}● attached${RESET}"
        name_color="${GREEN}"
    else
        status="${YELLOW}○ detached${RESET}"
        name_color="${BLUE}"
    fi

    # Print formatted row with fixed widths
    printf "${name_color}%-20s${RESET} ${MAGENTA}%-8s${RESET} %-18s %b\n" "$name" "$windows" "$created_date" "$status"
done
